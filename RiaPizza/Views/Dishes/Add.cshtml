@{
    ViewData["Title"] = "Add";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@section css{ 
    <style>
        .null-marbottom{
            margin-bottom:0 !important;
        }
        .right{
            float:right;
        }
    </style>
}
@*<script src="~/Angular/Controllers/DishCtrl.js"></script>*@
<script>
    App.controller("DishesCtrl", function ($scope, $http) {

        function JsonCallParam(Controller, Action, Parameters) {
            $.ajax({
                type: "POST",
                traditional: true,
                async: false,
                cache: false,
                url: '/' + Controller + '/' + Action,
                context: document.body,
                data: Parameters,
                success: function (json) {
                    list = null;
                    list = json;
                }
                ,
                error: function (xhr) {
                    list = null;
                }
            });
        }
        function JsonCall(Controller, Action) {
            $.ajax({
                type: "POST",
                traditional: true,
                async: false,
                cache: false,
                url: '/' + Controller + '/' + Action,
                context: document.body,
                success: function (json) {
                    list = null; list = json;
                },
                error: function (xhr) {
                    list = null;
                    //debugger;
                }
            });
        }

        $scope.allDishes = [];
        $scope.viewDishExtraType = [];
        $scope.viewDishExtras = [];
        $scope.dishCategories = [];
        $scope.multipleSizes = false;
        $scope.dishSizes = [];

        //Add Dish Objects
        $scope.addDish = { dishName: '', subName: '', description: '', dishCategoryId: 0, basePrice: 0, allergies: '', dishSizes:[] };
        $scope.addDishExtraTypes = [];
        $scope.getDishCategories = function () {
            JsonCall("DishCategories", "GetAllCategories");
            if (list !== null) {
                $scope.dishCategories = list;
                $scope.addDish.dishCategoryId = 0;
            }
        }

        //Start Dish Only Function
        $scope.saveDish = function () {
            if ($scope.addDish.dishName === "" || Number($scope.addDish.dishCategoryId) === 0 || $scope.addDish.basePrice === 0) { return; }
            for (var i = 0; i < $scope.addDishExtraTypes.length; i++) {
                if ($scope.addDishExtraTypes[i].typeName === "") { return; }
                for (var j = 0; j < $scope.addDishExtraTypes[i].dishExtras.length; j++)
                { if ($scope.addDishExtraTypes[i].dishExtras[j].extraName === "") { return; } }
            }

            if ($scope.multipleSizes) {
                $scope.addDish.dishSizes = $scope.dishSizes;
            }
            var pram = { "dish": JSON.stringify($scope.addDish), "dishExtraTypes": JSON.stringify($scope.addDishExtraTypes) };
            JsonCallParam("Dishes", "CreateDish", pram);
            if (list === "Success") {
                $("#addModal").modal("hide");
                swal("Added", "Dish Added!", "success");

                $scope.addDish = { dishName: '', subName: '', description: '', dishCategoryId: 0, basePrice: 0 };
                $scope.addDishExtraTypes = [];
                $scope.dishSizes = [];
                $scope.multipleSizes = false;
            }
        }
        $scope.saveDishExtraType = function () {
            for (var i = 0; i < $scope.addDishExtraTypes.length; i++) {
                if ($scope.addDishExtraTypes[i].typeName === "") { return; }
                for (var j = 0; j < $scope.addDishExtraTypes[i].dishExtras.length; j++) { if ($scope.addDishExtraTypes[i].dishExtras[j].extraName === "") { return; } }
            }

            var pram = { "dishId": JSON.stringify(document.getElementById('dishId').value), "dishExtraTypes": JSON.stringify($scope.addDishExtraTypes) };
            JsonCallParam("Dishes", "AddDishExtras", pram);
            if (list === "Success") {
                $("#addDishExtra").modal("hide");
                swal("Added", "Dish Topping Added!", "success");

                $scope.addDishExtraTypes = [];
                location.reload();
            }
        }
        $scope.pushDishExtraType = function () {
            var length = $scope.addDishExtraTypes.length;
            if (length === 0) {
                $scope.addDishExtraTypes.push({ typeName: '', chooseMultiple: true, dishExtras: [{ extraName: '', extraPrice: 0 }] });
            }
            else if ($scope.addDishExtraTypes[length - 1].typeName !== '') {
                $scope.addDishExtraTypes.push({ typeName: '', chooseMultiple: true, dishExtras: [{ extraName: '', extraPrice: 0 }] });
            }
        }
        $scope.pushDishExtra = function (i) {
            var length = $scope.addDishExtraTypes[i].dishExtras.length;
            if (length === 0) {
                $scope.addDishExtraTypes[i].dishExtras.push({ extraName: '', extraPrice: 0 });
            }
            else if ($scope.addDishExtraTypes[i].dishExtras[length - 1].extraName !== "") {
                $scope.addDishExtraTypes[i].dishExtras.push({ extraName: '', extraPrice: 0 });
            }
        }
        $scope.removeExtraType = function (i) {
            $scope.addDishExtraTypes.splice(i, 1);
        }
        $scope.removeExtra = function (extratype, i) {
            $scope.addDishExtraTypes[extratype].dishExtras.splice(i, 1);
            }
        $scope.addSize = function () {
            var count = $scope.dishSizes.length;
            if (count !== 0) {
                if ($scope.dishSizes[count - 1].size == "") return;
                else $scope.dishSizes.push({ size: "", basePrice: 0.0, diameter: "" });
            }
            else {
                $scope.dishSizes.push({ size: "", basePrice: 0.0, diameter: "" });
            }
        }
        $scope.removeSize = function (index) {
            $scope.dishSizes.splice(index, 1);
        }
        //End Dish Only Function
    
        //Start UI Functions
        $scope.openDishEditModal = function (dish) {
            $scope.editDish = { dishId: dish.dishId, dishName: dish.dishName, subName: dish.subName, allergies: dish.allergies, description: dish.description, dishCategoryId: dish.dishCategoryId, basePrice: dish.basePrice };
            $("#editDishModal").modal();
        }
        $scope.openDishExtraTypeEditModal = function (dishExtraType) {
            $scope.editDishExtraType = { dishExtraTypeId: dishExtraType.dishExtraTypeId, typeName: dishExtraType.typeName, dishId: dishExtraType.dishId, chooseMultiple: dishExtraType.chooseMultiple };
            $("#editDishModal").modal();
        }
        $scope.openDishExtraEditModal = function (dishextra) {
            $scope.editDishExtra = { dishExtraId: dishextra.dishExtraId, extraName: dishextra.extraName, dishExtraTypeId: dishextra.dishExtraTypeId, extraPrice: dishextra.extraPrice };
            $("#editDishExtraModal").modal();
        }
        //End UI Functions
        $scope.delDishCategory = function (cat) {
            $scope.delDishCategoryObj = { dishCategoryId: cat.dishCategoryId };
            var pram = { "dishCategory": JSON.stringify($scope.delDishCategoryObj) };
            JsonCallParam("DishCategories", "Delete", pram);
            if (list == "Success") {
                $scope.getAllCategories();
                swal("Removed", "Dish Category Deleted!", "success");
            }
        }
    });

</script>
<div class="container-fluid" ng-controller="DishesCtrl">
    <div class="block-header">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="breadcrumb breadcrumb-style ">
                    <li class="breadcrumb-item">
                        <h4 class="page-title">Dishes</h4>
                    </li>
                    <li class="breadcrumb-item bcrumb-1">
                        <a href="~/Home/Index">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    <li class="breadcrumb-item bcrumb-2">
                        <a href="#" onClick="return false;">Dishes</a>
                    </li>
                    <li class="breadcrumb-item active">Add</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="card">
                <div class="header">
                    <h2>
                        <strong>Add</strong> Dish
                    </h2>
                </div>
                <div class="body" ng-init="">
                    <h2 class="card-inside-title">Dish Details</h2>
                    <div class="row clearfix">
                        <div class="col-lg-12 col-md-12 null-marbottom">
                            <label>Dish Category <span class="text-danger">*</span></label>
                            <div class="form-group" ng-init="getDishCategories()">
                                <select class="form-control" ng-model="addDish.dishCategoryId" required>
                                    <option value="0" hidden>Select Category</option>
                                    <option ng-repeat="cat in dishCategories" value="{{cat.dishCategoryId}}">{{cat.categoryName}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 null-marbottom">
                            <div class="form-group">
                                <label>Dish Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" placeholder="Enter Dish Name" ng-model="addDish.dishName" required>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12 null-marbottom">
                            <div class="form-group">
                                <label>Sub Name</label>
                                <input type="text" class="form-control" placeholder="Enter Dish Sub Name" ng-model="addDish.subName">
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 null-marbottom">
                            <div class="form-group">
                                <label>Base Price <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" placeholder="$$" ng-model="addDish.basePrice" min="0"
                                       required>
                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 null-marbottom">
                            <div class="form-group">
                                <label>Allergies <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" placeholder="enter the allergies" ng-model="addDish.allergies" min="0"
                                       required>
                            </div>
                        </div>
                        <div class="col-md-12 col-md-12">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea placeholder="Enter Description of Dish" class="form-control" ng-model="addDish.description"></textarea>
                            </div>
                        </div>
                        <div class="col-md-12 col-md-12">
                            <div class="form-group">
                                <label>Multiple Sizes</label>
                                <div class="switch">
                                    <label>
                                        <input type="checkbox" ng-model="multipleSizes">
                                        <span class="lever switch-col-light-blue"></span>
                                    </label>
                                </div>
                            </div>
                            <form name="sizeForm" ng-if="multipleSizes">
                                <table>
                                    <tr>
                                        <th width="30%">Size</th>
                                        <th width="30%">Price</th>
                                        <th width="30%">Diameter</th>
                                        <th width="10%">
                                            <button class="btn btn-primary" ng-click="addSize()"><i class="fa fa-plus"></i></button>
                                        </th>
                                    </tr>
                                    <tr ng-repeat="size in dishSizes">
                                        <td>
                                            <div class="form-group">
                                                <input type="text" class="form-control" name="size" ng-model="size.size" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <input type="number" min="0" class="form-control" name="sizebaseprice" ng-model="size.basePrice" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="form-group">
                                                <input type="text" class="form-control" name="diameter" ng-model="size.diameter" />
                                            </div>
                                        </td>
                                        <td>
                                            <button class="btn btn-danger" ng-click="removeSize($index)"><i class="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                </table>
                            </form>
                        </div>
                    </div>

                    <h2 class="card-inside-title">
                        Dish Toppings
                        <button style="float:right" type="button" class="btn btn-primary" ng-click="pushDishExtraType()">
                            <i class="fa fa-plus"></i>
                        </button>
                    </h2>
                    <br />
                    <div class="row clearfix" ng-repeat="extraType in addDishExtraTypes" ng-init="extraTypeIndex=$index">
                        <div class="col-lg-10 null-marbottom">
                            <div class="form-group null-marbottom">
                                <div class="form-line">
                                    <label>Topping Category Head <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" placeholder="Enter Topping Name" ng-model="extraType.typeName">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1">
                            <div class="form-group null-marbottom right">
                                <div class="form-line">
                                    <label>Allow Multiple <span class="text-danger">*</span></label>
                                    <div class="switch">
                                        <label>
                                            <input type="checkbox" ng-model="extraType.chooseMultiple">
                                            <span class="lever switch-col-light-blue"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1">
                            <div class="form-group null-marbottom right">
                                <div class="form-line">
                                    <label>Actions</label><br />
                                    <button class="btn btn-danger" ng-click="removeExtraType($index)"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-1"></div>
                        <div class="col-lg-10">
                            <span style="font-weight:bold">Dish Toppings</span>
                            <button ng-click="pushDishExtra($index)" type="button" class="btn bg-orange btn-circle waves-effect waves-circle waves-float right">
                                <i class="fa fa-plus"></i>
                            </button>
                            <div class="row clearfix" ng-if="extraType.dishExtras.length > 0" style="margin-top:30px">
                                <div class="col-lg-5"><label>Topping Name <span class="text-danger">*</span></label></div>
                                <div class="col-lg-5"><label>Topping Price <span class="text-danger">*</span></label></div>
                                <div class="col-lg-2"><label class="right">Actions</label></div>
                            </div>
                            <div class="row clearfix" ng-repeat="extra in extraType.dishExtras" ng-init="extraIndex=$index">
                                <div class="col-lg-5">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Topping" ng-model="extra.extraName"
                                               required>
                                    </div>
                                </div>
                                <div class="col-lg-5">
                                    <input type="number" class="form-control" placeholder="$$" ng-model="extra.extraPrice"
                                           required>
                                </div>
                                <div class="col-lg-2">
                                    <button class="btn btn-danger right" ng-click="removeExtra(extraTypeIndex, extraIndex)"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1"></div>

                    </div>

                    <button class="btn btn-info" style="float:right; margin-right:5px">Clear</button>
                    <button ng-click="saveDish()" class="btn btn-success" style="float:right;">Save</button>
                </div>
            </div>
        </div>
    </div>

</div>

@section scripts{

    <script src="~/assets/js/form.min.js"></script>
    <script src="~/assets/js/pages/forms/form-wizard.js"></script>
}